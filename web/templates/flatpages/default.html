
<!DOCTYPE html>
<html>
    <title>Test Page</title>
</head>
<body>
    <div id="content"></div>
    </div>
</body>
    <script src="https://cdn.jsdelivr.net/npm/wiky.js@0.0.1/wiky.min.js"></script><head>
    <script>
        function wikitextToHtml(wikitext) {
  // Helper function to escape HTML special characters
  function escapeHtml(text) {
    return text
      .replace(/&/g, "&amp;")
      .replace(/</g, "&lt;")
      .replace(/>/g, "&gt;")
      .replace(/"/g, "&quot;")
      .replace(/'/g, "&#039;");
  }

  // Split the wikitext into lines
  let lines = wikitext.split('\n');
  let html = [];
  let inList = false;
  let listType = '';

  for (let line of lines) {
    // Convert headings
    if (/^(=+)\s*(.*?)\s*\1$/.test(line)) {
      const match = line.match(/^(=+)\s*(.*?)\s*\1$/);
      const level = match[1].length;
      const content = match[2];
      html.push(`<h${level}>${escapeHtml(content)}</h${level}>`);
      continue;
    }

    // Convert lists
    const listMatch = line.match(/^([*#]+)(.*)/);
    if (listMatch) {
      const [, listMarkers, content] = listMatch;
      const currentListType = listMarkers[0] === '*' ? 'ul' : 'ol';
      const level = listMarkers.length;

      if (!inList || currentListType !== listType) {
        if (inList) html.push(`</${listType}>`);
        html.push(`<${currentListType}>`);
        inList = true;
        listType = currentListType;
      }

      html.push(`${'  '.repeat(level)}<li>${processInlineElements(content.trim())}</li>`);
      continue;
    } else if (inList) {
      html.push(`</${listType}>`);
      inList = false;
    }

    // Convert paragraphs (non-empty lines that haven't been processed)
    if (line.trim() !== '') {
      html.push(`<p>${processInlineElements(line)}</p>`);
    }
  }

  if (inList) {
    html.push(`</${listType}>`);
  }

  return html.join('\n');

  // Helper function to process inline elements
  function processInlineElements(text) {
    // Convert bold and italic
    text = text.replace(/'''(.*?)'''/g, '<strong>$1</strong>');
    text = text.replace(/''(.*?)''/g, '<em>$1</em>');

    // Convert links
    text = text.replace(/\[\[(.*?)\]\]/g, (match, content) => {
      const parts = content.split('|');
      const link = parts[0];
      const linkText = parts[1] || link;
      return `<a href="${encodeURIComponent(link)}">${escapeHtml(linkText)}</a>`;
    });

    return text;
  }
}

// Example usage
const wikitext = `
= Main Heading =
== Sub Heading ==
This is a '''bold''' and ''italic'' text.
Here's a [[link|Custom Link Text]].

* List item 1
* List item 2
** Nested list item

# Numbered item 1
# Numbered item 2

This is a regular paragraph.
`;

const html = wikitextToHtml(wikitext);
document.getElementById('content').innerHTML = html;
    </script>
</html>